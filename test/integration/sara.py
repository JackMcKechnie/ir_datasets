import ir_datasets
from ir_datasets.formats import GenericQuery, GenericDoc, TrecQrel
from ir_datasets.datasets.sara import SaraDoc
from base import DatasetIntegrationTest
import unittest

test_doc_1 = '''Message-ID: <7439130.1075863427132.JavaMail.evans@thyme>\nDate: Tue, 19 Jun 2001 16:58:58 -0700 (PDT)\nFrom: j.kaminski@enron.com\nTo: urszula@pacbell.net\nSubject: RE: ticket\nMime-Version: 1.0\nContent-Type: text/plain; charset=us-ascii\nContent-Transfer-Encoding: 7bit\nX-From: Kaminski, Vince J </O=ENRON/OU=NA/CN=RECIPIENTS/CN=VKAMINS>\nX-To: 'Urszula Sobczyk <urszula@pacbell.net>@ENRON' <IMCEANOTES-Urszula+20Sobczyk+20+3Curszula+40pacbell+2Enet+3E+40ENRON@ENRON.com>\nX-cc: \nX-bcc: \nX-Folder: \\VKAMINS (Non-Privileged)\\Kaminski, Vince J\\Sent Items\nX-Origin: Kaminski-V\nX-FileName: VKAMINS (Non-Privileged).pst\n\n6011 3000 5062  8237\n\n12/02\n\n -----Original Message-----\nFrom: \tUrszula Sobczyk <urszula@pacbell.net>@ENRON [mailto:IMCEANOTES-Urszula+20Sobczyk+20+3Curszula+40pacbell+2Enet+3E+40ENRON@ENRON.com] \nSent:\tTuesday, June 19, 2001 6:37 PM\nTo:\tKaminski, Vince J\nSubject:\tRe: ticket\n\nOur phone number is 1-800-801-1055.\nUrszula\n\nVince.J.Kaminski@enron.com wrote:\n\n> What are the hours for Conti vs. Air France? I am the ofice for another 45\n> minutes.\n> Your phone number?\n>\n> Vince\n>\n>     -----Original Message-----\n>    From:   Urszula Sobczyk <urszula@pacbell.net>@ENRON\n>              [mailto:IMCEANOTES-Urszula+20Sobczyk+20+3Curszula+40pacbell+2Enet+3E+40ENRON@ENRON.com]\n>\n>    Sent:   Tuesday, June 19, 2001 5:56 PM\n>    To:     Kaminski, Vince J\n>    Subject:  Re: ticket\n>\n>    Dzien Dobry ponownie,\n>    Na wszystkie te polaczenia ceny wychodzi ok. $1700.00.\n>    Jedyne co to wylot 04 lipca z IAH przez Chicago do Warszawy - LOT,\n>    powrot 09 lipca, Warszawa - JFK, JFK\n>    przez DFW (Dallas) do Houston.  Cena wychodz $1107.10.  Bardzo prosze o\n>    kontakt.\n>    Urszula\n>\n>    Vince.J.Kaminski@enron.com wrote:\n>\n>    > Another question. What about a Continental flight to Amsterdam and\n>    from\n>    > Amsterdam to Warsaw?\n>    >\n>    > I can also fly Continental through Rome or London, as long as I don't\n>    have\n>    > to change airports.\n>    >\n>    > Vince\n>    >\n>    >     -----Original Message-----\n>    >    From:   Urszula Sobczyk <urszula@pacbell.net>@ENRON\n>    >\n>    [mailto:IMCEANOTES-Urszula+20Sobczyk+20+3Curszula+40pacbell+2Enet+3E+40ENRON@ENRON.com]\n>    >\n>    >    Sent:   Tuesday, June 19, 2001 1:50 PM\n>    >    To:     vkamins@enron.com\n>    >    Subject:  re: ticket\n>    >\n>    >    Dzien dobry Panu,\n>    >    Na wylot 04 lipca z IAH do Warszawy i powrot 09 lipca (8 lipca nie\n>    bylo\n>    >    miejsca) cena wynosi $1680.26.\n>    >    Bardzo prosze o kontakt czy jest Pan zainteresowany.\n>    >    Pozdrawiam,\n>    >    Urszula'''
test_doc_2 = '''Message-ID: <17588232.1075863426860.JavaMail.evans@thyme>\nDate: Mon, 18 Jun 2001 14:59:24 -0700 (PDT)\nFrom: j.kaminski@enron.com\nTo: j_martin@baylor.edu\nSubject: RE: Have you seen this?\nMime-Version: 1.0\nContent-Type: text/plain; charset=us-ascii\nContent-Transfer-Encoding: 7bit\nX-From: Kaminski, Vince J </O=ENRON/OU=NA/CN=RECIPIENTS/CN=VKAMINS>\nX-To: \'"John D. Martin" <J_Martin@baylor.edu>@ENRON\' <IMCEANOTES-+22John+20D+2E+20Martin+22+20+3CJ+5FMartin+40baylor+2Eedu+3E+40ENRON@ENRON.com>\nX-cc: \nX-bcc: \nX-Folder: \\VKAMINS (Non-Privileged)\\Kaminski, Vince J\\Sent Items\nX-Origin: Kaminski-V\nX-FileName: VKAMINS (Non-Privileged).pst\n\nYes,\n\nThanks a lot.\n\nVince\n\n -----Original Message-----\nFrom: \t"John D. Martin" <J_Martin@baylor.edu>@ENRON [mailto:IMCEANOTES-+22John+20D+2E+20Martin+22+20+3CJ+5FMartin+40baylor+2Eedu+3E+40ENRON@ENRON.com] \nSent:\tMonday, June 18, 2001 9:32 AM\nTo:\tKaminski, Vince J\nSubject:\tHave you seen this?\n\n"Conditional Value-at-Risk for General Loss Distributions"\n\n      BY:  TYRRELL R. ROCKAFELLAR\n              University of Washington\n              Department of Applied Mathematics\n           STANISLAV P. URYASEV\n              University of Florida\n              Department of Industrial and Systems Engineering\n\nDocument:  Available from the SSRN Electronic Paper Collection:\n           http://papers.ssrn.com/paper.taf?abstract_id=267256\n\n           Other Electronic Document Delivery:\n           http://www.ise.ufl.edu/uryasev/CVaR2.pdf\n           SSRN only offers technical support for papers\n           downloaded from the SSRN Electronic Paper Collection\n           location. When URLs wrap, you must copy and paste\n           them into your browser eliminating all spaces.\n\nPaper ID:  U of Florida, ISE Dept. Working Paper No. 2001-5\n    Date:  April 4, 2001\n\n Contact:  STANISLAV P. URYASEV\n   Email:  Mailto:uryasev@ise.ufl.edu\n  Postal:  University of Florida\n           Department of Industrial and Systems Engineering\n           PO Box 116595\n           303 Weil Hall\n           Gainesville, FL 32611-6595  USA\n   Phone:  352-392-3091\n     Fax:  352-392-3537\n Co-Auth:  TYRRELL R. ROCKAFELLAR\n   Email:  Mailto:rtr@math.washington.edu\n  Postal:  University of Washington\n           Department of Applied Mathematics\n           408 L Guggenheim Hall\n           Box 352420\n           Seattle, WA 98195-2420  USA\n\nABSTRACT:\n Fundamental properties of conditional value-at-risk, as a\n measure of risk with significant advantages over value-at-risk,\n are derived for loss distributions in finance that can involve\n discreetness. Such distributions are of particular importance in\n applications because of the prevalence of models based on\n scenarios and finite sampling. Conditional value-at-risk is able\n to quantify dangers beyond value-at-risk, and moreover it is\n coherent. It provides optimization shortcuts which, through\n linear programming techniques, make practical many large-scale\n calculations that could otherwise be out of reach. The numerical\n efficiency and stability of such calculations, shown in several\n case studies, are illustrated further with an example of index\n tracking.\n\n Keywords: Value-at-risk, conditional value-at-risk, mean\n shortfall, coherent risk measures, risk sampling, scenarios,\n hedging, index tracking, portfolio optimization, risk management\n\n\nJEL Classification: G0\n______________________________\n\nJohn D. Martin\nCarr P. Collins Chair in Finance\nFinance Department\nBaylor University\nPO Box 98004\nWaco, TX 76798\n254-710-4473 (Office)\n254-710-1092 (Fax)\nJ_Martin@Baylor.edu\nweb:    http://hsb.baylor.edu/html/martinj/home.html  '''
test_doc_3 = '''Message-ID: <9688199.1075846160316.JavaMail.evans@thyme>\nDate: Mon, 24 Jul 2000 11:26:00 -0700 (PDT)\nFrom: steven.kean@enron.com\nTo: peggy.mahoney@enron.com\nSubject: Re: Rich Products\nMime-Version: 1.0\nContent-Type: text/plain; charset=us-ascii\nContent-Transfer-Encoding: 7bit\nX-From: Steven J Kean\nX-To: Peggy Mahoney\nX-cc: \nX-bcc: \nX-Folder: \\Steven_Kean_Dec2000_1\\Notes Folders\\All documents\nX-Origin: KEAN-S\nX-FileName: skean.nsf\n\nLooks good.\n\n\n\n\nPeggy Mahoney\n07/24/2000 06:20 PM\nTo: Mark Palmer/Corp/Enron@ENRON, Steven J Kean/HOU/EES@EES, Karen \nDenne/Corp/Enron@ENRON, Cedric Burgher/Corp/Enron@ENRON, Mark \nKoenig/Corp/Enron@ENRON, Paula Rieker/Corp/Enron@ENRON, Jeremy \nBlachman/HOU/EES@EES, Harold G Buchanan/HOU/EES@EES, Karen S Owens@ees@EES, \nKevin Hughes/HOU/EES@EES, Mark S Muller/HOU/EES@EES, Vicki Sharp/HOU/EES@EES, \nMarty Sunde/HOU/EES@EES, Dan Leff/HOU/EES@EES, Elizabeth Tilney/HOU/EES@EES, \nDave S Laipple/DUB/EES@EES, James E Keller/HOU/EES@EES\ncc:  \nSubject: Rich Products\n\nPlease review the attached draft news release about our agreement with Rich \nProducts\nand let me know if you have any comments by 5pm Tuesday, July 25.  We are \nscheduled\nto release on Wednesday, July 26.  If you have any questions, please call me \nat x57034.\n\nRich Products is a major US food manufacturer headquartered in Buffalo, NY.  \nThe company\nranked #122 in Forbes Private 500 and has sales around $1.5 billion.  Rich \nProducts is owned\nand operated by the founding Rich family.  Products manufactured include \nfrozen meats,\nbakery products and non-dairy creamers.\n\n\n\n\n'''
class TestSara(DatasetIntegrationTest):
    def test_docs(self):
        # Test that the dataset 'dummy' has 15 documents, and test the specific docs at indices 0, 9, and 14
        self._test_docs('sara', count=1702, items={
            10: SaraDoc('54579', test_doc_1 , 1),
            100: SaraDoc('54567', test_doc_2 , 1),
            1701: SaraDoc('173837', test_doc_3 , 0)
        })

    def test_queries(self):
        # Test that the dataset 'dummy' has 4 queries, and test the specific queries at indices 0 and 3
        self._test_queries('sara', count=150, items={
            0: GenericQuery('1', 'Politicians that decide the plans from state to state'),
            87: GenericQuery('88', 'Enron procurement'),
            122: GenericQuery('123', 'Senators linked to enron')
        })

    def test_qrels(self):
        # Test that the dataset 'dummy' has 60 qrels, and test the specific qrels at indices 0, 9, and 59
        self._test_qrels('sara', count=34413, items={
            0: TrecQrel('1', '201645', 0, '0'),
            13: TrecQrel('2', '221411', 2, '0'),
            31: TrecQrel('2', '173259', 1, '0')
        })

if __name__ == '__main__':
    unittest.main()